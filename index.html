<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dasbor Kehadiran Karyawan ‚Ä¢ SmartAttend</title>

  <!-- PWA Manifest & Meta -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0f766e">
  <link rel="apple-touch-icon" href="assets/AMAN-S-Logo.jpg">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css?v=3.3" />
  <style>
    /* Styling for Inventory, Latest Info, Education, Attendance & Employee Table Borders */
    #route-inventory table,
    #route-latest table,
    #route-education table,
    #route-attendance table,
    .emp-table {
      width: 100%;
      border-collapse: collapse;
    }

    #route-inventory table th,
    #route-inventory table td,
    #route-latest table th,
    #route-latest table td,
    #route-education table th,
    #route-education table td,
    #route-attendance table th,
    #route-attendance table td,
    .emp-table th,
    .emp-table td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }

    #route-inventory table th,
    #route-latest table th,
    #route-education table th,
    #route-attendance table th,
    .emp-table th {
      background: #f3f4f6;
    }

    /* === CRITICAL FIX: MOBILE GAUGE CSS (Direct Injection) === */
    .mob-stat-grid-3 {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 8px;
    }

    .mob-stat-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 12px 4px;
      text-align: center;
      border-radius: 16px;
      background: #fff;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .mob-stat-card.stat-red {
      border-bottom: 3px solid var(--danger);
    }

    .mob-stat-card.stat-blue {
      border-bottom: 3px solid var(--primary);
    }

    .mob-stat-card.stat-gray {
      border-bottom: 3px solid #64748b;
    }

    .mob-stat-card .lbl-sm {
      font-size: 0.7rem;
      font-weight: 700;
      color: #64748b;
      letter-spacing: 0.5px;
      margin-bottom: 4px;
      text-transform: uppercase;
    }

    .mob-stat-card .val {
      font-size: 1.6rem;
      font-weight: 800;
      line-height: 1;
      margin-bottom: 2px;
      color: #0f172a;
    }

    .mob-stat-card .lbl-xs {
      font-size: 0.7rem;
      color: #94a3b8;
    }

    /* Gauge styles */
    .gauge-simple {
      position: relative;
      width: 140px;
      height: 140px;
      margin: 0 auto;
      border-radius: 50%;
      background: conic-gradient(#0ea5e9 0%, #e2e8f0 0%);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .gauge-simple::before {
      content: '';
      position: absolute;
      width: 110px;
      height: 110px;
      background: #fff;
      border-radius: 50%;
    }

    .gauge-val {
      position: relative;
      z-index: 2;
      font-size: 2rem;
      font-weight: 800;
      color: #0ea5e9;
    }
  </style>

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"
    referrerpolicy="no-referrer"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="js/translation.js"></script>
  <script src="config.local.js"></script>
  <script>
    if (!localStorage.getItem('SA_SESSION')) { window.location.replace('login.html'); }
  </script>

  <!-- Helper style kecil (tidak bentrok) -->
  <style>
    #empModal .modal {
      position: relative
    }

    #empModal .modal-close {
      position: absolute;
      right: 10px;
      top: 8px;
      border: 0;
      background: transparent;
      font-size: 24px;
      line-height: 1;
      cursor: pointer
    }

    .camera-actions {
      display: flex;
      gap: 10px;
      align-items: center
    }

    .hidden {
      display: none
    }

    .company-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px
    }

    .company-card {
      background: var(--panel, #fff);
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 1px 2px rgba(0, 0, 0, .04)
    }

    .company-card .name {
      font-weight: 600
    }

    .company-card .sub {
      color: #64748b;
      font-size: 12px;
      margin-top: 2px
    }

    .company-card .badge {
      font-weight: 800;
      font-size: 22px
    }

    #tableShiftTime input[type="time"] {
      width: 140px;
      max-width: 100%
    }

    @media (max-width:1100px) {
      #route-scan .scan-stats-grid {
        grid-template-columns: 1fr
      }
    }

    /* === EDUCATION UI (dasar) === */
    .img-preview {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 6px
    }

    .img-preview img {
      width: 96px;
      height: 96px;
      object-fit: cover;
      border-radius: 10px;
      border: 1px solid #e5e7eb
    }

    .edu-thumb {
      width: 56px;
      height: 56px;
      object-fit: cover;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      cursor: pointer
    }

    #eduHighlightsCard .card-title {
      display: flex;
      align-items: center;
      gap: 8px
    }

    .edu-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 12px
    }

    .edu-item {
      background: var(--surface, #fff);
      border: 1px solid var(--line, #e6eefc);
      border-radius: 16px;
      padding: 12px;
      box-shadow: 0 4px 14px rgba(0, 0, 0, .05);
      display: grid;
      grid-template-columns: 72px 1fr;
      gap: 12px
    }

    .edu-item .thumb {
      width: 72px;
      height: 72px;
      border-radius: 12px;
      object-fit: cover;
      border: 1px solid var(--line, #e6eefc);
      background: #f3f4f6
    }

    .edu-item .t {
      font-weight: 700;
      line-height: 1.25;
      margin-bottom: 2px
    }

    .edu-item .d {
      color: #64748b;
      font-size: 13px;
      line-height: 1.35;
      display: -webkit-box;
      -webkit-box-orient: vertical;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      overflow: hidden;
    }

    .edu-item .meta {
      color: #94a3b8;
      font-size: 12px;
      margin-top: 6px
    }

    .edu-bar {
      position: relative;
      margin-top: 10px;
      height: 14px;
      border-radius: 999px;
      background: var(--line, #e6eefc);
      overflow: hidden;
      box-shadow: inset 0 1px 2px rgba(0, 0, 0, .05)
    }

    .edu-bar i {
      display: block;
      height: 100%;
      width: var(--pct, 60%);
      border-radius: inherit;
      background: linear-gradient(90deg, var(--primary-500, #4a8cff), var(--primary-300, #a6c8ff))
    }

    .edu-bar .val {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 12px;
      color: #0b2545
    }

    /* ===== BRAND CORNER (Logo kiri-atas untuk Dashboard & Scan) ===== */
    :root {
      --brand-size: 150px;
      /* 76‚Äì150px sesuai kebutuhan */
      --brand-gap: 12px;
    }

    #route-dashboard,
    #route-scan {
      position: relative;
    }

    .brand-corner {
      --panel-alpha: .55;
      /* opasitas panel logo */

      position: absolute;
      top: 12px;
      left: 12px;
      width: var(--brand-size);
      height: var(--brand-size);
      display: grid;
      place-items: center;
      padding: 10px;
      background: rgba(255, 255, 255, var(--panel-alpha));
      border: 1px solid var(--line);
      border-radius: 16px;
      box-shadow: var(--shadow);
      z-index: 4;
      backdrop-filter: blur(6px);
    }

    .brand-corner img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      display: block;
    }

    /* Geser konten agar tidak ketimpa logo - DIHAPUS karena logo sudah di header */
    /* #route-dashboard .greet {
      margin-left: calc(var(--brand-size) + var(--brand-gap));
    }

    #route-scan .scan-hero-left {
      margin-left: calc(var(--brand-size) + var(--brand-gap));
    } */

    /* Responsif */
    @media (max-width: 1100px) {
      .header-modern {
        flex-direction: column;
        align-items: center;
        text-align: center;
        padding: 12px;
        height: auto;
        gap: 12px;
      }

      .header-logo {
        position: relative;
        left: auto;
        top: auto;
        margin-bottom: 8px;
        /* Allow wider logo on mobile */
        width: auto;
        height: auto;
        max-width: 280px;
        max-height: 100px;
      }

      .header-logo img {
        width: auto;
        height: auto;
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
      }

      .brand-corner {
        --brand-size: 70px;
        top: 10px;
        left: 10px;
      }

      .header-content {
        margin-left: 0;
        margin-right: 0;
        max-width: 100%;
      }

      .header-title {
        font-size: 1.1rem;
        line-height: 1.3;
      }

      .header-subtitle {
        font-size: 0.85rem;
      }

      .header-right {
        position: relative;
        right: auto;
        top: auto;
        flex-direction: row;
        justify-content: center;
        margin-top: 4px;
      }

      .header-clock {
        font-size: 1.5rem;
      }
    }

    /* Tetap tampil saat fullscreen */
    #route-dashboard:fullscreen .brand-corner,
    #route-dashboard:-webkit-full-screen .brand-corner,
    #route-scan:fullscreen .brand-corner,
    #route-scan:-webkit-full-screen .brand-corner {
      position: absolute;
      top: 12px;
      left: 12px;
    }

    /* =========================
       PATCH: LOCK SIZE + HIDE % LABEL
       ========================= */
    .edu-bar .val {
      display: none !important;
    }

    /* sembunyikan label % */

    /* Kunci ukuran logo panel (dua lokasi) */
    #brandLogoPanelDash.brand-corner,
    #brandLogoPanelScan.brand-corner {
      inline-size: var(--brand-size) !important;
      block-size: var(--brand-size) !important;
      min-inline-size: var(--brand-size) !important;
      min-block-size: var(--brand-size) !important;
      aspect-ratio: 1 / 1;
      border-radius: 50% !important;
      /* buat bulat */
      flex: 0 0 auto !important;
    }

    #brandLogoPanelDash.brand-corner img,
    #brandLogoPanelScan.brand-corner img {
      inline-size: 100% !important;
      block-size: 100% !important;
      object-fit: contain !important;
    }

    /* ====== Layout gabungan: Recent + Education ====== */
    #recentCard .subhead {
      font-weight: 700;
      margin: 0 0 8px;
      color: var(--text)
    }

    #recentCard .recent-flex {
      display: grid;
      grid-template-columns: minmax(260px, 0.95fr) 1.05fr;
      /* kiri=Education, kanan=Tabel */
      gap: 12px;
      align-items: start;
      min-height: 0;
    }

    #recentCard .recent-edu {
      display: flex;
      flex-direction: column;
      min-height: 0
    }

    #recentCard .recent-table {
      min-width: 0
    }

    #recentCard .edu-list.compact {
      grid-template-columns: 1fr
    }

    #recentCard .edu-list.compact .edu-item {
      grid-template-columns: 56px 1fr;
      gap: 10px;
      padding: 10px;
      border-radius: 12px
    }

    #recentCard .edu-list.compact .thumb {
      width: 56px;
      height: 56px;
      border-radius: 10px
    }

    /* Jika Education kosong ‚Üí sembunyikan kolom kiri & tabel full */
    #recentCard[data-has-edu="0"] .recent-edu {
      display: none
    }

    #recentCard[data-has-edu="0"] .recent-table {
      grid-column: 1 / -1
    }

    /* Responsif */
    @media (max-width:1100px) {
      #recentCard .recent-flex {
        grid-template-columns: 1fr
      }

      #recentCard .recent-edu {
        order: 2
      }
    }

    /* =========================
       >> BARU: Animasi ‚Äúhidup‚Äù untuk Education (Highlights)
       ========================= */
    .edu-item {
      position: relative;
      will-change: transform, box-shadow;
      animation: eduPulse 3.4s ease-in-out infinite;
    }

    .edu-item::after {
      content: "";
      position: absolute;
      inset: -20% -10% auto -10%;
      height: 60%;
      background: radial-gradient(60% 50% at 20% 0%, rgba(255, 255, 255, .55), rgba(255, 255, 255, 0) 60%);
      pointer-events: none;
      animation: eduGlow 3.4s ease-in-out infinite;
    }

    .edu-item::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(130deg, transparent 5%, rgba(255, 255, 255, .55) 50%, transparent 95%);
      mix-blend-mode: screen;
      transform: translateX(-130%);
      animation: eduSweep 6s linear infinite;
      pointer-events: none;
    }

    .edu-item .thumb {
      animation: eduPing 2.6s ease-in-out infinite;
      transform-origin: center;
    }

    .edu-bar i {
      position: relative;
    }

    .edu-bar i::after {
      content: "";
      position: absolute;
      inset: 0;
      transform: translateX(-120%);
      background: linear-gradient(120deg, transparent 0%, rgba(255, 255, 255, .65) 50%, transparent 100%);
      animation: eduBarShine 2.6s linear infinite;
    }

    @keyframes eduPulse {

      0%,
      100% {
        box-shadow: 0 8px 18px rgba(2, 6, 23, .08);
        transform: translateY(0)
      }

      50% {
        box-shadow: 0 14px 28px rgba(2, 6, 23, .16);
        transform: translateY(-2px)
      }
    }

    @keyframes eduGlow {

      0%,
      100% {
        opacity: .18;
        transform: translateY(0)
      }

      50% {
        opacity: .34;
        transform: translateY(-4px)
      }
    }

    @keyframes eduSweep {
      0% {
        transform: translateX(-130%)
      }

      100% {
        transform: translateX(130%)
      }
    }

    @keyframes eduPing {

      0%,
      100% {
        transform: scale(1)
      }

      50% {
        transform: scale(1.04)
      }
    }

    @keyframes eduBarShine {
      0% {
        transform: translateX(-120%)
      }

      100% {
        transform: translateX(120%)
      }
    }

    @media (prefers-reduced-motion:reduce) {

      .edu-item,
      .edu-item::before,
      .edu-item::after,
      .edu-item .thumb,
      .edu-bar i::after {
        animation: none !important;
      }
    }

    /* Sidebar Close Button (Mobile Only) */
    @media (max-width: 768px) {
      .btn-close-sidebar {
        display: block !important;
      }

      /* === MOBILE SCAN REDESIGN (REF STYLE) === */
      .mobile-only {
        display: block !important;
      }

      .desktop-only {
        display: none !important;
      }

      /* Mobile Container */
      #mobScanView {
        background: #f8fafc;
        min-height: 80vh;
        padding-bottom: 80px;
        /* Space for scroll */
      }

      /* 1. Curved Blue Header */
      .mob-scan-header {
        background: linear-gradient(135deg, var(--primary-700), var(--primary-600));
        padding: 24px 20px 40px;
        /* Extra bottom pad for curve */
        border-bottom-left-radius: 32px;
        border-bottom-right-radius: 32px;
        color: #fff;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 10px 30px rgba(0, 141, 191, 0.25);
        margin-bottom: -20px;
        /* Pull content up overlap */
      }

      .mob-scan-header .logo-area {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .mob-scan-header img {
        height: 40px;
        width: auto;
        background: #fff;
        border-radius: 8px;
        padding: 2px;
      }

      .mob-scan-header .title-area h2 {
        margin: 0;
        font-size: 1.1rem;
        font-weight: 700;
      }

      .mob-scan-header .title-area p {
        margin: 0;
        font-size: 0.8rem;
        opacity: 0.9;
      }

      /* 2. Overlap Card (Stats) */
      .mob-stats-overlap {
        margin: 0 16px 20px;
        position: relative;
        z-index: 2;
      }

      /* Re-use .grid-4 but flattened/styled */
      .mob-stats-overlap .grid-4 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
      }

      .mob-stats-overlap .card-solid {
        background: #fff;
        border-radius: 16px;
        padding: 14px;
        text-align: center;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        border: none;
      }

      .mob-stats-overlap .card-solid .val {
        font-size: 1.4rem;
        color: var(--primary-700);
        font-weight: 800;
      }

      .mob-stats-overlap .card-solid .lbl {
        font-size: 0.75rem;
        color: #64748b;
        margin-top: 4px;
      }

      /* 3. Action Area (Camera & Input) */
      .mob-action-area {
        padding: 0 20px;
        margin-bottom: 24px;
        position: relative;
        z-index: 10;
      }

      #btnCamToggleMob {
        width: 100%;
        background: var(--primary-500);
        color: #fff;
        border: none;
        padding: 16px;
        border-radius: 16px;
        font-size: 1rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        box-shadow: 0 8px 20px rgba(51, 190, 255, 0.3);
        margin-bottom: 12px;
      }

      #mobScanInput {
        width: 100%;
        padding: 14px;
        border: 1px solid #e2e8f0;
        background: #fff;
        border-radius: 12px;
        text-align: center;
        font-size: 1rem;
      }

      /* 4. Vertical Feed (Recent Scans) */
      .mob-feed-title {
        padding: 0 20px;
        font-size: 1rem;
        font-weight: 700;
        color: #334155;
        margin-bottom: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      #mobScanFeed {
        padding: 0 20px;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .mob-feed-card {
        background: #fff;
        padding: 12px;
        border-radius: 16px;
        display: flex;
        align-items: center;
        gap: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
        border: 1px solid #f1f5f9;
        animation: slideInUp 0.3s ease;
      }

      .mob-feed-card img {
        width: 48px;
        height: 48px;
        border-radius: 10px;
        object-fit: cover;
        background: #eee;
      }

      .mob-feed-card .info {
        flex: 1;
      }

      .mob-feed-card .info h4 {
        margin: 0 0 4px;
        font-size: 0.95rem;
        color: #0f172a;
      }

      .mob-feed-card .info p {
        margin: 0;
        font-size: 0.8rem;
        color: #64748b;
      }

      .mob-feed-card .status {
        padding: 4px 10px;
        border-radius: 8px;
        font-size: 0.75rem;
        font-weight: 600;
      }

      .mob-feed-card .status.in {
        background: #ecfdf5;
        color: #059669;
      }

      .mob-feed-card .status.out {
        background: #fff1f2;
        color: #e11d48;
      }

      @keyframes slideInUp {
        from {
          opacity: 0;
          transform: translateY(10px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    }

    /* Desktop Default */
    .mobile-only {
      display: none;
    }

    @media (max-width: 768px) {
      .desktop-only {
        display: none;
      }


      /* Compact Cards */
      #route-scan .card-solid {
        padding: 10px !important;
        min-height: 80px !important;
      }

      #route-scan .card-solid .pills {
        display: none !important;
      }

      /* Hide pills */
      #route-scan .card-solid .lbl {
        font-size: 0.7rem !important;
        margin-bottom: 0 !important;
        opacity: 0.9;
      }

      #route-scan .card-solid .val {
        font-size: 1.6rem !important;
        margin-top: 2px !important;
      }

      /* Input Field */
      #route-scan .scan-input.light {
        padding: 10px 12px !important;
        font-size: 0.95rem !important;
        margin: 10px 0 !important;
      }

      /* Company Grid Compact */
      .company-card {
        padding: 8px 10px !important;
        flex-direction: row !important;
        align-items: center !important;
        gap: 8px !important;
        border-radius: 8px !important;
      }

      .company-card .name {
        font-size: 0.8rem !important;
      }

      .company-card .sub {
        font-size: 0.65rem !important;
      }

      .company-card .badge {
        font-size: 1.1rem !important;
      }

      /* Hide Active Shifts Time Range */
      #activeShiftsContainer .shift-card {
        padding: 6px 10px !important;
      }

      #activeShiftsContainer h4 {
        font-size: 0.85rem !important;
      }

      #activeShiftsContainer small {
        font-size: 0.7rem !important;
      }
    }
  </style>
</head>

<body>
  <!-- Mobile Sidebar Toggle -->
  <button id="btnMobileNav" class="mobile-nav-toggle" aria-label="Toggle Navigation">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </button>

  <!-- Sidebar Overlay -->
  <div id="sidebarOverlay" class="sidebar-overlay"></div>

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="brand">
      <img src="assets/AMAN-S-Logo.jpg" alt="AMAN-S Logo" style="height: 44px; width: auto; border-radius: 8px;">
      <div>
        <div class="brand-name">Aman-S</div>
        <div class="brand-sub" style="font-size: 0.75rem; line-height: 1.2;">Aplikasi Manajemen Pengamanan Aset dan
          Safety
        </div>
      </div>
      <!-- NEW: Close Button for Mobile -->
      <button class="btn-close-sidebar" onclick="window.toggleMobileMenu()" aria-label="Close Menu"
        style="margin-left: auto; background: none; border: none; color: #0f172a; cursor: pointer; display: none; z-index:50;">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <nav class="nav">
      <button class="navlink active" data-route="dashboard">üìä <span data-i18n="nav_dashboard">Dasbor</span></button>
      <button class="navlink" data-route="scan">üîé <span data-i18n="nav_scan">Scan Barcode</span></button>
      <button class="navlink" data-route="employees">üë• <span data-i18n="nav_employees">Database
          Karyawan</span></button>
      <button class="navlink" data-route="shifts">üïò <span data-i18n="nav_shifts">Shift Setting</span></button>
      <button class="navlink" data-route="attendance">üìë <span data-i18n="nav_report">Laporan 24 Jam</span></button>
      <button class="navlink" data-route="overtime-report">üïí <span>Laporan Overtime</span></button>
      <button class="navlink" data-route="general-report">üìà <span>General Report</span></button>
      <button class="navlink" data-route="latest">üì∞ <span data-i18n="nav_latest">Latest information</span></button>
      <button class="navlink" data-route="education">üéì <span data-i18n="nav_education">Education</span></button>
      <button class="navlink" data-route="inventory">üì¶ <span>Keluar Masuk Barang</span></button>
      <button class="navlink" data-route="analysis" style="color:var(--orange-600)">‚òï <span>Analisis
          Izin</span></button>

      <hr style="border:0; border-top:1px solid var(--line); margin:8px 0;">

      <button class="navlink" id="btnLogout" style="color:var(--danger); font-weight:600;">
        üö™ <span data-i18n="nav_logout">Log Out</span>
      </button>
    </nav>

    <div class="sidebar-footer"><small data-i18n="footer_version">v1.4 ‚Ä¢ Local-first</small></div>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <!-- DASHBOARD -->
    <section class="route active" id="route-dashboard">

      <!-- MOBILE DASHBOARD (Visible ONLY on Mobile) -->
      <div class="mob-dash-container">
        <!-- 1. Header & Greeting -->
        <div class="mob-header">
          <img src="assets/AMAN-S-Logo.jpg" class="mob-logo">
          <div class="mob-brand">
            <h3>AMAN-S APP</h3>
            <span>PLN Nusantara Power Services</span>
          </div>
        </div>

        <!-- 2. Hero Clock Card -->
        <div class="mob-hero-card">
          <div class="mob-clock" id="mobClock">--:--</div>
          <div class="mob-date" id="mobDate">...</div>
          <div class="mob-greet" id="mobGreet">Selamat Datang</div>
        </div>

        <!-- 3. Active On-Site (NEW MOBILE - COMPACT) -->
        <!-- 3. Active On-Site (ULTRA SLIM) -->
        <div class="card-solid stat-orange"
          style="margin: 0 16px 8px; padding: 8px 12px; display:flex; justify-content:space-between; align-items:center; min-height: 40px;"
          onclick="showStatDetail('active_site')">
          <div style="display:flex; align-items:center; gap:8px;">
            <!-- Icon / Dot -->
            <div
              style="width:8px; height:8px; background:#fff; border-radius:50%; box-shadow:0 0 5px rgba(255,255,255,0.6);">
            </div>
            <div
              style="font-size:0.75rem; font-weight:600; text-transform:uppercase; letter-spacing:0.3px; opacity:0.95;">
              Active On-Site</div>
          </div>
          <div style="display:flex; align-items:baseline; gap:4px;">
            <div class="val" id="mobStatActive" style="font-size:1.1rem; font-weight:800; line-height:1;">0</div>
            <span style="font-size:0.65rem; opacity:0.8;">Personil</span>
          </div>
        </div>

        <!-- 4. Stats Row (GRID) -->
        <div class="mob-stats-overlap">
          <div class="mob-stat-grid-3">
            <!-- Terlambat -->
            <div class="card-solid mob-stat-card stat-red" id="mobCardLate">
              <div class="lbl-sm">TERLAMBAT</div>
              <div class="val" id="mobStatLate">0</div>
              <div class="lbl-xs">Orang</div>
            </div>
            <!-- Hadir -->
            <div class="card-solid mob-stat-card stat-blue" id="mobCardPresent">
              <div class="lbl-sm">HADIR</div>
              <div class="val" id="mobStatPresent">0</div>
              <div class="lbl-xs">Orang</div>
            </div>
            <!-- Total -->
            <div class="card-solid mob-stat-card stat-gray" id="mobCardTotal">
              <div class="lbl-sm">TOTAL</div>
              <div class="val" id="mobStatTotal">0</div>
              <div class="lbl-xs">Karyawan</div>
            </div>
          </div>

          <!-- 4. Gauge (NEW DESIGN) -->
          <div class="card-solid mob-gauge-card" style="margin-top:12px; text-align:center; padding:16px;">
            <div style="font-weight:700; margin-bottom:12px; font-size:0.95rem; color:#1e293b;">Kehadiran Hari Ini</div>

            <div class="gauge-simple">
              <div class="gauge-bg"></div>
              <div class="gauge-fill" id="mobGaugeFill"></div>
              <div class="gauge-val" id="mobGaugeVal">0%</div>
            </div>
          </div>
        </div>
      </div>

      <!-- DESKTOP DASHBOARD (Hidden on Mobile) -->
      <div class="desktop-dash">
        <!-- MODERN HEADER (New) -->
        <div class="header-modern">
          <!-- Logo Kiri -->
          <div class="header-logo" id="brandLogoPanelDash">
            <img src="assets/LOGO PLN NP SERVICES - FIN.png" alt="PLN Nusantara Power Services"
              onerror="this.onerror=null; this.src='assets/LOGO PLN NP SERVICES - FIN.svg';">
          </div>

          <!-- Teks Tengah -->
          <div class="header-content">
            <h1 class="header-title" data-i18n="dash_welcome_title">SELAMAT DATANG DI PT PLN NUSANTARA POWER SERVICES
              LINGKUP PLTU AMPANA ‚ö°</h1>
            <div class="header-subtitle">
              <div class="marquee-wrap">
                <div class="marquee-content" data-i18n="dash_welcome_sub">ANDA BERADA DI KAWASAN PLN NPS UNIT PLTU
                  AMPANA
                  DAN
                  WAJIB MEMATUHI SEMUA ATURAN YANG BERLAKU</div>
              </div>
            </div>
          </div>

          <!-- Kanan: Jam & Button -->
          <div class="header-right">
            <div class="header-clock" id="liveClock">--:--</div>
            <button id="btnFullDash" class="header-btn" data-i18n="btn_fullscreen">‚õ∂ Layar Penuh</button>
          </div>
        </div>

        <!-- Kartu statistik -->
        <!-- Kartu statistik (V2 Solid Color) -->
        <div class="grid-4">
          <!-- Blue: Total Karyawan -->
          <div class="card-solid stat-blue" data-hover-card="interactive"
            data-tooltip="Total semua karyawan yang terdaftar dalam database."
            onclick="$('.navlink[data-route=\'employees\']').click()">
            <div class="pills">
              <span class="pill" data-i18n="pill_today">Today</span>
              <span class="pill" data-i18n="pill_active">Active</span>
            </div>
            <div class="lbl" data-i18n="stat_total_emp">Total Karyawan</div>
            <div class="val" id="statTotalEmp">0</div>
          </div>

          <!-- Orange: Active On-Site (Revised) -->
          <div class="card-solid stat-orange" data-hover-card="interactive"
            data-tooltip="Estimasi jumlah karyawan yang saat ini berada di lokasi (Masuk - Pulang)."
            onclick="showStatDetail('active_site')">
            <div class="pills">
              <span class="pill" data-i18n="pill_live">Live</span>
            </div>
            <div class="lbl">Active On-Site</div>
            <div class="val" id="statScan24h">0</div>
          </div>

          <!-- Cyan: On-time -->
          <div class="card-solid stat-cyan" data-hover-card="interactive"
            data-tooltip="Karyawan yang melakukan scan MASUK tepat waktu hari ini." onclick="showStatDetail('ontime')">
            <div class="pills">
              <span class="pill">Daily</span>
            </div>
            <div class="lbl" data-i18n="stat_ontime">On-time</div>
            <div class="val" id="statOnTime">0</div>
          </div>

          <!-- Green: Terlambat -->
          <div class="card-solid stat-green" data-hover-card="interactive"
            data-tooltip="Karyawan yang terlambat melakukan scan MASUK hari ini." onclick="showStatDetail('late')">
            <div class="pills">
              <span class="pill">Alert</span>
            </div>
            <div class="lbl" data-i18n="stat_late">Terlambat</div>
            <div class="val" id="statLate">0</div>
          </div>
        </div>

        <!-- Hide Old Stats (Backup) -->
        <div class="grid-3 hidden">
          <div class="card stat">
            <div class="stat-sub"><span id="statShiftBreakdown">‚Äî</span></div>
          </div>
          <div class="card stat">
            <div class="stat-sub"><span data-i18n="stat_in">Datang</span>: <b id="statIn24h">0</b> ‚Ä¢ <span
                data-i18n="stat_out">Pulang</span>: <b id="statOut24h">0</b></div>
          </div>
        </div>

        <!-- Active Shift & Overtime Row -->
        <div style="display:flex; gap:16px; margin-bottom:20px; align-items:stretch;">

          <!-- Active Shift Panel -->
          <div class="card" style="flex:1; border-left:4px solid var(--primary-500)">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px">
              <h3 style="margin:0; font-size:1.1rem">üïí Shift Yang Sedang Bertugas</h3>
            </div>
            <div id="activeShiftsContainer" style="display:flex; flex-wrap:wrap; gap:8px;">
              <!-- Shift content rendered by JS -->
            </div>
          </div>

          <!-- Overtime Panel (Dashboard) -->
          <div id="overtimePanelDash_Fixed" class="card" onclick="showOvertimeList()" title="Klik untuk melihat detail"
            style="display:none; width: auto; min-width: 200px; border-left:4px solid var(--danger-500); background: #fff0f0; cursor:pointer; align-items:center; justify-content:space-between; gap:16px;">
            <div>
              <h3 style="margin:0; font-size:1.1rem; color:var(--danger-700)">Overtime</h3>
              <div class="muted" style="font-size:0.85rem">Melewati jam pulang</div>
            </div>
            <div id="overtimeCountDash_Fixed" style="font-size:2rem; font-weight:800; color:var(--danger-600)">0</div>
          </div>

        </div>

        <!-- Company Presence -->
        <div class="card" id="companyPresenceCard">
          <div class="card-title" data-i18n="company_attendance_title">Company Attendance (today)</div>
          <div class="live-row" style="margin:2px 0 10px">
            <b data-i18n="company_live_stats">STATISTIK KEHADIRAN LANGSUNG</b>
            <span class="muted" id="companyLiveTime">--:--:--</span>
          </div>
          <div id="companyPresenceGrid" class="company-grid"></div>
        </div>

        <!-- ===== DASH TRIO ===== -->
        <div class="dash-trio">
          <div class="card" id="monthCalendarCard" data-hover-card>
            <div class="card-title" data-i18n="card_monthly_calendar">Kalender Bulan Ini</div>
            <div id="monthCalendar"></div>
          </div>

          <div class="card" id="newsCardDash">
            <div class="card-title" data-i18n="card_latest_info">Informasi Terbaru‚ö†Ô∏èüì¢</div>
            <div class="news-grid" id="newsGridDash"></div>
          </div>

          <!-- GABUNG: Aktivitas Terbaru + Education (fleksibel) -->
          <div class="card" id="recentCard" data-has-edu="0">
            <div class="recent-flex">
              <!-- Education (Highlights) -->
              <aside class="recent-edu" id="recentEduPane">
                <div class="subhead">Education (Highlights)</div>
                <div id="eduListRecent" class="edu-list compact"></div>
              </aside>

              <!-- Tabel Aktivitas -->
              <div class="recent-table">
                <div class="subhead" style="display:flex; justify-content:space-between; align-items:center;">
                  <div>
                    <span data-i18n="card_recent_activity">Aktivitas Terbaru</span>
                    <small id="recentCount" class="muted">(3 terakhir hari ini)</small>
                  </div>
                  <button onclick="exportExcel()" class="btn-export"
                    style="background:#28a745; color:white; border:none; padding:4px 8px; border-radius:4px; cursor:pointer; font-size:0.8rem;">
                    üìä Export Excel
                  </button>
                </div>
                <div class="table-wrap">
                  <table class="table" id="tableRecent">
                    <thead>
                      <tr>
                        <th data-i18n="table_time">Waktu</th>
                        <th data-i18n="table_status">Status</th>
                        <th data-i18n="table_nid">NID</th>
                        <th data-i18n="table_name">Nama</th>
                        <th data-i18n="table_shift">Shift</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <!-- /GABUNG -->
        </div>

        <!-- (Kartu Education terpisah DIHAPUS) -->
    </section>

    <!-- GENERAL REPORT -->
    <section class="route hidden" id="route-general-report">
      <div class="header-modern" style="margin-bottom:20px;">
        <div class="header-content" style="margin:0;">
          <h1 class="header-title" style="text-align:left;">General Report & Analytics</h1>
          <div class="header-subtitle" style="text-align:left;">Visualisasi Tren Kinerja & Kedisiplinan Karyawan</div>
        </div>
      </div>

      <!-- Summary Stats Row -->
      <div class="grid-4" style="margin-bottom:20px;">
        <div class="card-solid stat-blue">
          <div class="lbl">Total Karyawan</div>
          <div class="val" id="repTotalEmp">0</div>
        </div>
        <div class="card-solid stat-orange">
          <div class="lbl">Avg. Terlambat (7 Hari)</div>
          <div class="val" id="repAvgLate">0</div>
        </div>
        <div class="card-solid stat-green">
          <div class="lbl">Avg. Kehadiran (7 Hari)</div>
          <div class="val" id="repAvgPresent">0%</div>
        </div>
        <div class="card-solid stat-cyan">
          <div class="lbl">Top Divisi Rajin</div>
          <div class="val" id="repTopDiv" style="font-size:1.2rem;">-</div>
        </div>
      </div>

      <!-- Charts Grid -->
      <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap:20px;">

        <!-- Chart 1: Late Trend -->
        <div class="card">
          <div class="card-title">Tren Keterlambatan (14 Hari Terakhir)</div>
          <div style="position:relative; height:300px; width:100%;">
            <canvas id="chartLateTrend"></canvas>
          </div>
        </div>

        <!-- Chart 2: In/Out Traffic -->
        <div class="card">
          <div class="card-title">Traffic Jam Scan (7 Hari Terakhir)</div>
          <div style="position:relative; height:300px; width:100%;">
            <canvas id="chartInOutFlow"></canvas>
          </div>
        </div>

        <!-- Chart 3: Composition -->
        <div class="card">
          <div class="card-title">Komposisi Kehadiran Hari Ini</div>
          <div style="position:relative; height:300px; width:100%; display:flex; justify-content:center;">
            <canvas id="chartAttendanceRate"></canvas>
          </div>
        </div>

        <!-- Chart 4: Division Performance -->
        <div class="card">
          <div class="card-title">Kinerja Per Divisi (30 Hari Terakhir)</div>
          <div style="position:relative; height:300px; width:100%;">
            <canvas id="chartDivPerformance"></canvas>
          </div>
        </div>

        <!-- Chart 5: Overtime Trend -->
        <div class="card">
          <div class="card-title">Tren Lembur (14 Hari Terakhir)</div>
          <div style="position:relative; height:300px; width:100%;">
            <canvas id="chartOvertimeTrend"></canvas>
          </div>
        </div>

        <!-- Chart 6: Top 5 Overtime -->
        <div class="card">
          <div class="card-title">Top 5 Karyawan Paling Rajin Lembur (30 Hari)</div>
          <div style="position:relative; height:300px; width:100%;">
            <canvas id="chartTopOvertime"></canvas>
          </div>
        </div>

      </div>
    </section>

    <!-- SCAN -->
    <section class="route hidden" id="route-scan">
      <!-- === MOBILE SCAN VIEW === -->
      <div id="mobScanView" class="mobile-only">
        <!-- 1. Header Lengkung -->
        <div class="mob-scan-header">
          <div class="logo-area">
            <img src="assets/AMAN-S-Logo.jpg" alt="Logo" style="border-radius:12px;">
            <div class="title-area">
              <h2 style="font-weight:800; font-size:1.1rem;">AMAN-S APP</h2>
              <p>PLN Nusantara Power Services</p>
            </div>
          </div>
          <div style="text-align:right; color:#fff;">
            <div style="font-size:0.8rem; opacity:0.8;">Jam</div>
            <div class="header-clock" style="font-size:1.2rem; font-weight:700;" id="liveClockMob">--:--</div>
            <script>
              (function () {
                function updateC() {
                  var el = document.getElementById('liveClockMob');
                  if (el) el.innerText = new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }).replace('.', ':');
                }
                setInterval(updateC, 1000);
                updateC();
              })();
            </script>
          </div>
        </div>

        <!-- 2. Overlap Stats -->
        <!-- 2. Overlap Stats -->
        <!-- Stats Removed to avoid ID conflict with Dashboard -->
        <div style="margin-bottom: 20px;"></div>

        <!-- 3. Action Area -->
        <div class="mob-action-area">
          <button id="btnCamToggleMob" type="button" onclick="toggleCamera()">
            üì∏ Buka Kamera
          </button>
          <!-- Hidden Reader for Mobile -->
          <div id="readerMob" class="hidden"
            style="width:100%; min-height:300px; background:#000; border-radius:12px; overflow:hidden; border:2px solid var(--primary-500); margin-bottom:12px;">
          </div>

          <input type="text" id="mobScanInput" placeholder="Ketik NID/Nama..." autocomplete="off">
        </div>

        <!-- 4. Recent Scans Feed -->
        <div class="mob-feed-title">
          <span>Riwayat Terbaru</span>
          <span style="font-size:0.8rem; color:#64748b; font-weight:400;">Hari ini</span>
        </div>
        <div id="mobScanFeed">
          <!-- Items injected by JS -->
        </div>
      </div>

      <!-- === DESKTOP SCAN VIEW === -->
      <div id="deskScanView" class="desktop-only">
        <!-- MODERN HEADER (Scan Version) -->
        <div class="header-modern">
          <!-- Logo Kiri -->
          <div class="header-logo">
            <img src="assets/LOGO PLN NP SERVICES - FIN.png" alt="PLN Nusantara Power Services"
              onerror="this.onerror=null; this.src='assets/LOGO PLN NP SERVICES - FIN.svg';">
          </div>

          <!-- Teks Tengah -->
          <div class="header-content">
            <h1 class="header-title" data-i18n="scan_title_main">SELAMAT DATANG DI PT PLN NUSANTARA POWER SERVICES
              LINGKUP PLTU AMPANA ‚ö°</h1>
            <div class="header-subtitle">
              <div class="marquee-wrap">
                <div class="marquee-content" data-i18n="dash_welcome_sub">
                  UTAMAKAN KESELAMATAN DAN KESEHATAN KERJA ‚Ä¢ PASTIKAN SUDAH SCAN PULANG SEBELUM MENINGGALKAN AREA
                </div>
              </div>
            </div>
          </div>

          <!-- Kanan: Jam & Button -->
          <div class="header-right">
            <div class="header-clock" id="liveClockScan">--:--</div>
            <button id="btnFull" class="header-btn" data-i18n="btn_fullscreen">‚õ∂ Layar Penuh</button>
          </div>
        </div>

        <!-- Stat Cards in Scan Page (Clone of Dashboard) -->
        <div class="grid-4" style="padding: 0 1rem; margin-top: 1rem;">
          <!-- Blue: Total Karyawan -->
          <div class="card-solid stat-blue" data-hover-card="interactive"
            data-tooltip="Total semua karyawan yang terdaftar dalam database."
            onclick="alert('Total Karyawan: ' + (employees?.length || 0))">
            <div class="pills">
              <span class="pill">Today</span>
              <span class="pill">Active</span>
            </div>
            <div class="lbl" data-i18n="stat_total_emp">Total Karyawan</div>
            <div class="val" id="statTotalEmpScan">0</div>
          </div>

          <!-- Orange: Active On-Site (Scan Page) -->
          <div class="card-solid stat-orange" data-hover-card="interactive"
            data-tooltip="Estimasi jumlah karyawan yang saat ini berada di lokasi (Masuk - Pulang)."
            onclick="showStatDetail('active_site')">
            <div class="pills">
              <span class="pill">Live</span>
            </div>
            <div class="lbl">Active On-Site</div>
            <div class="val" id="statScan24hScan">0</div>
          </div>

          <!-- Cyan: On-time -->
          <div class="card-solid stat-cyan" data-hover-card="interactive"
            data-tooltip="Karyawan yang melakukan scan MASUK tepat waktu hari ini." onclick="showStatDetail('ontime')">
            <div class="pills">
              <span class="pill">Daily</span>
            </div>
            <div class="lbl" data-i18n="stat_ontime">On-time</div>
            <div class="val" id="statOnTimeScan">0</div>
          </div>

          <!-- Green: Terlambat -->
          <div class="card-solid stat-green" data-hover-card="interactive"
            data-tooltip="Karyawan yang terlambat melakukan scan MASUK hari ini." onclick="showStatDetail('late')">
            <div class="pills">
              <span class="pill">Alert</span>
            </div>
            <div class="lbl" data-i18n="stat_late">Terlambat</div>
            <div class="val" id="statLateScan">0</div>
          </div>
        </div>

        <div class="scan-ui">
          <div class="scan-hero">
            <!-- Kiri -->
            <div class="scan-hero-left">
              <div class="scan-hello"></div>
              <!-- title actions removed -->

              <!-- CAMERA SCAN SECTION -->
              <div id="cameraSection" style="margin-bottom: 12px; display: flex; flex-direction: column; gap: 8px;">
                <button id="btnCamToggle" class="btn light"
                  style="width:100%; display:flex; align-items:center; justify-content:center; gap:8px;">
                  üì∑ <span id="btnCamText">Buka Kamera</span>
                </button>
                <div id="reader"
                  style="width: 100%; display:none; border-radius:12px; overflow:hidden; border:2px solid var(--primary-300);">
                </div>
              </div>

              <!-- Input Scan -->
              <input id="scanInput" class="scan-input light" placeholder="Klik di sini lalu scan‚Ä¶" autocomplete="off"
                autocapitalize="off" spellcheck="false" inputmode="none" data-i18n="scan_placeholder" />

              <!-- Break Mode Buttons -->
              <div class="break-controls" style="display:flex; gap:10px; margin-top:10px; justify-content:center;">
                <button id="btnBreakOut" class="btn warning" style="min-width:120px;">‚òï Izin Keluar</button>
                <button id="btnBreakIn" class="btn primary" style="min-width:120px;">üîô Kembali</button>
                <button id="btnBreakCancel" class="btn" style="min-width:100px; display:none;">‚ùå Batal</button>
              </div>
              <div id="breakModeIndicator" class="hidden"
                style="margin-top:8px; text-align:center; font-weight:bold; color:var(--orange-600);">
                Mode: <span id="breakModeText">ISTIRAHAT</span>
              </div>

              <div class="hint light marquee-wrap" style="max-width: 600px; margin-top: 10px;">
                <div class="marquee-content" data-i18n="scan_hint">Utamakan Keselamatan dan Kesehatan Kerja.</div>
              </div>

              <!-- Company Presence (Scan Version) -->
              <!-- Company Presence (Scan Version) -->
              <!-- Company Presence (Scan Version) -->
              <div class="card" id="companyPresenceCardScan"
                style="margin-top: 16px; border:none; box-shadow:none; padding:0;">
                <div class="live-row" style="margin:2px 0 16px">
                  <b data-i18n="company_live_stats" style="font-size: 1.05rem;">STATISTIK KEHADIRAN LANGSUNG</b>
                </div>

                <div id="companyPresenceGridScan" class="company-grid"
                  style="grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));"></div>
              </div>

              <!-- Shift & Overtime Panel Row -->
              <div class="row-panels" style="display:flex; gap:10px; margin-top:10px;">
                <!-- Shift Panel (Scan Version) -->
                <div id="activeShiftsScan" style="flex:1; display:flex; flex-wrap:wrap; gap:8px;"></div>

                <!-- Overtime Panel -->
                <div id="overtimePanelScan" class="card-light" onclick="showOvertimeList()"
                  title="Klik untuk melihat detail"
                  style="display:none; flex:0 1 auto; min-width:140px; border-color:var(--danger-200); background:var(--danger-50); padding: 8px 12px; align-items:center; justify-content:space-between; flex-direction:row; gap:12px; cursor:pointer; transition: background 0.2s;">
                  <div>
                    <div class="card-title-light"
                      style="color:var(--danger-700); margin-bottom:2px; font-size: 0.95rem; font-weight:800;">Overtime
                    </div>
                    <div class="muted" style="font-size:0.8rem">Melewati jam pulang</div>
                  </div>
                  <div id="overtimeCount" style="font-size:1.5rem; font-weight:700; color:var(--danger-600)">0</div>
                </div>
              </div>

              <!-- STATISTIK KEHADIRAN (REALTIME) -->
              <!-- STATISTIK REMOVED -->

              <!-- Tabel 5 scan terbaru hari ini (MOVED HERE) -->
              <div class="scan-table card-light" style="margin-top:2px;">
                <div class="card-title-light" data-i18n="scan_history_title">Riwayat Scan (5 terbaru hari ini)</div>
                <div class="table-wrap light">
                  <table class="table light" id="tableScan" style="font-size: 0.85rem;">
                    <thead>
                      <tr>
                        <th data-i18n="table_time">Waktu</th>
                        <th data-i18n="table_status">Status</th>
                        <th data-i18n="table_nid">NID</th>
                        <th data-i18n="table_name">Nama</th>
                        <th data-i18n="col_job">Jabatan</th>
                        <th data-i18n="scan_col_company">Perusahaan</th>
                        <th data-i18n="table_shift">Shift</th>
                        <th>Keterangan</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- Kanan -->
            <div class="scan-hero-right" id="scanResult">
              <style>
                /* Local override for right panel scroll */
                #scanResult {
                  overflow-y: auto;
                  justify-content: flex-start;
                }
              </style>
              <!-- Wrapper Baru untuk Horizontal Layout -->
              <div class="scan-profile-card">
                <div class="photo-big" id="scanPhoto"></div>
                <div class="info">
                  <div class="name" id="scanName">‚Äî</div>
                  <div class="meta"><span id="scanNID">‚Äî</span> <span id="scanTitle">‚Äî</span></div>
                  <div class="meta"><span id="scanCompany">‚Äî</span> <span id="scanShift">‚Äî</span></div>
                  <div class="pill light" id="scanShiftCheck">‚Äî</div>
                  <div class="ts" id="scanTs">‚Äî</div>
                </div>
              </div>

              <!-- Info terbaru (MOVED HERE) -->
              <div class="card-light" style="margin-top:24px; width:100%; text-align:left;">
                <div class="card-title-light">Informasi Terbaru ‚ö†Ô∏èüì¢</div>
                <div class="news-grid" id="newsGridScan"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- EMPLOYEES -->
    <section class="route hidden" id="route-employees">
      <div class="toolbar">
        <div class="left">
          <button id="btnAddEmp" class="btn primary" data-i18n="btn_add">Ôºã Tambah</button>
          <input type="file" id="fileImportEmp" accept=".xlsx,.xls" hidden>
          <button id="btnImportEmp" class="btn" data-i18n="btn_import">‚¨ÜÔ∏è Import Excel</button>
          <button id="btnExportEmp" class="btn ghost" data-i18n="btn_export">‚¨áÔ∏è Export Excel</button>
          <button id="btnTemplateEmp" class="btn ghost" data-i18n="btn_template">üìÑ Unduh Template</button>
          <button id="btnSyncEmp" class="btn primary" title="Upload data lokal ke Cloud">‚òÅÔ∏è Sync Cloud</button>
        </div>
        <div class="right" style="display:flex; gap:8px;">
          <select id="filterEmpGroup" class="input" style="padding:8px; border-radius:8px; width:140px;">
            <option value="">Semua Grup</option>
            <option value="A">Group A</option>
            <option value="B">Group B</option>
            <option value="C">Group C</option>
            <option value="D">Group D</option>
            <option value="DAYTIME">Daytime</option>
          </select>
          <input id="searchEmp" class="search" placeholder="Cari nama atau NID‚Ä¶" data-i18n="search_placeholder" />
        </div>
      </div>

      <!-- Container untuk Kartu Perusahaan (Dynamic) -->
      <div id="employeeListContainer" class="company-stack">
        <!-- Content will be rendered by JS -->
      </div>

      <!-- HIDE OLD TABLE (for backup reference if needed, or remove) -->
      <div class="card hidden">
        <div class="table-wrap">
          <table class="table" id="tableEmp">
            <thead>
              <tr>
                <th data-i18n="col_photo">Foto</th>
                <th data-i18n="table_nid">NID</th>
                <th data-i18n="table_name">Nama</th>
                <th data-i18n="col_job">Jabatan</th>
                <th data-i18n="scan_col_company">Perusahaan</th>
                <th data-i18n="table_shift">Shift</th>
                <th data-i18n="table_action">Aksi</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- SHIFTS -->
    <section class="route hidden" id="route-shifts">
      <div class="card">
        <div class="card-title" style="display:flex; justify-content:space-between; cursor:pointer"
          onclick="toggleCollapse(this, 'COLLAPSE_SHIFT_CFG')">
          <span data-i18n="shift_title">Pengaturan Jam Shift</span>
          <span class="arrow">‚ñº</span>
        </div>
        <div class="collapsible-content">
          <div class="table-wrap">
            <table class="table" id="tableShiftTime">
              <thead>
                <tr>
                  <th style="width:220px" data-i18n="shift_col_code">Kode</th>
                  <th data-i18n="shift_col_in">Datang</th>
                  <th data-i18n="shift_col_out">Pulang</th>
                  <th style="width:120px" data-i18n="shift_col_action">Aksi</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><select disabled>
                      <option>Pagi (P)</option>
                    </select></td>
                  <td><input type="time" id="shiftPagiStart" value="08:00"></td>
                  <td><input type="time" id="shiftPagiEnd" value="16:00"></td>
                  <td></td>
                </tr>
                <tr>
                  <td><select disabled>
                      <option>Sore (S)</option>
                    </select></td>
                  <td><input type="time" id="shiftSoreStart" value="16:00"></td>
                  <td><input type="time" id="shiftSoreEnd" value="24:00"></td>
                  <td></td>
                </tr>
                <tr>
                  <td><select disabled>
                      <option>Malam (M)</option>
                    </select></td>
                  <td><input type="time" id="shiftMalamStart" value="24:00"></td>
                  <td><input type="time" id="shiftMalamEnd" value="07:00"></td>
                  <td></td>
                </tr>
                <tr>
                  <td><select disabled>
                      <option>Daytime</option>
                    </select></td>
                  <td><input type="time" id="shiftDayStart" value="07:30"></td>
                  <td><input type="time" id="shiftDayEnd" value="16:00"></td>
                  <td></td>
                </tr>
                <tr>
                  <td><select disabled>
                      <option>Libur (L)</option>
                    </select></td>
                  <td><input type="time" disabled></td>
                  <td><input type="time" disabled></td>
                  <td></td>
                </tr>

              </tbody>
            </table>
          </div>
          <div class="toolbar">
            <button id="btnSaveShift" class="btn primary">üíæ Simpan Pengaturan</button>
            <span class="muted">Gunakan <b>24:00</b> untuk akhir hari. Sistem otomatis menangani lintas tengah
              malam.</span>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-title" style="display:flex; justify-content:space-between; cursor:pointer"
          onclick="toggleCollapse(this, 'COLLAPSE_SHIFT_SCHED')">
          <span>Jadwal Shift Bulanan</span>
          <span class="arrow">‚ñº</span>
        </div>
        <div class="collapsible-content">
          <div class="toolbar" style="margin-bottom:8px">
            <div class="left" style="gap:10px; flex-wrap:wrap">
              <label>Bulan <input type="month" id="schedMonth" min="2022-01" max="2030-12"></label>
              <button class="btn" id="btnSchedDownload">üìÑ Download Template</button>
              <input type="file" id="fileImportSched" accept=".xlsx,.xls" hidden>
              <button class="btn" id="btnSchedImport">‚¨ÜÔ∏è Import Template</button>
            </div>
            <div class="right" style="gap:8px; display:flex">
              <button class="btn primary" id="btnSchedSave">üíæ Simpan Jadwal</button>
              <button class="btn ghost" id="btnSchedReset">üßπ Reset Bulan</button>
            </div>
          </div>
          <div class="table-wrap">
            <table class="table" id="tableSched"></table>
          </div>
          <small class="muted">Tips: pilih nama pada setiap sel. Data tersimpan per-bulan di perangkat ini.</small>
        </div>
      </div>
      <script>
        (function () {
          const cfg = localStorage.getItem('COLLAPSE_SHIFT_CFG') === '1';
          const sched = localStorage.getItem('COLLAPSE_SHIFT_SCHED') === '1';

          if (cfg) {
            const el = document.querySelector('#route-shifts .card:nth-child(1) .collapsible-content');
            if (el) { el.classList.add('hidden'); el.previousElementSibling.querySelector('.arrow').textContent = '‚ñ∂'; }
          }
          if (sched) {
            const el = document.querySelector('#route-shifts .card:nth-child(2) .collapsible-content');
            if (el) { el.classList.add('hidden'); el.previousElementSibling.querySelector('.arrow').textContent = '‚ñ∂'; }
          }
        })();
      </script>
    </section>

    <!-- ATTENDANCE -->
    <section class="route hidden" id="route-attendance">
      <!-- BARU: Panel Laporan Bulanan -->
      <div class="card" style="margin-bottom: 20px; border-left: 4px solid var(--primary-500);">
        <div class="card-title">üìä Laporan Efektifitas & Kinerja Bulanan</div>
        <div class="toolbar" style="margin-top:10px;">
          <div class="left" style="align-items: center; gap: 10px;">
            <label>Pilih Bulan: <input type="month" id="reportMonth"
                style="padding: 8px; border: 1px solid var(--line); border-radius: 8px;"></label>
            <button id="btnDownloadMonthlyReport" class="btn primary">‚¨áÔ∏è Download Laporan Kinerja (PDF)</button>
          </div>
        </div>
        <small class="muted">Laporan ini mencakup: Total Hadir, Total Terlambat, dan Hitungan Overtime per
          Karyawan.</small>
      </div>

      <div class="toolbar">
        <div class="left">
          <label>Dari <input type="date" id="attFrom"></label>
          <label>Sampai <input type="date" id="attTo"></label>
          <select id="attGroupFilter" class="input" style="width:auto; padding:8px 10px;">
            <option value="">Semua Group</option>
            <option value="A">Group A</option>
            <option value="B">Group B</option>
            <option value="C">Group C</option>
            <option value="D">Group D</option>
            <option value="DAYTIME">Group DAYTIME</option>
          </select>
          <!-- Filter Status -->
          <select id="attStatusFilter" class="input" style="width:auto; padding:8px 10px;">
            <option value="">Semua Status</option>
            <option value="LATE">Terlambat</option>
            <option value="ONTIME">Tepat Waktu</option>
            <option value="OVERTIME">Lembur (Overtime)</option>
            <option value="UNKNOWN">Tanpa Keterangan</option>
          </select>
          <button id="btnFilterAtt" class="btn">üîç Tampilkan</button>

          <!-- Search Filter -->
          <input type="search" id="attSearch" placeholder="Cari Nama / NID..."
            style="padding: 8px 12px; border: 1px solid var(--line); border-radius: 8px; width: 200px;">

          <button id="btnExportAtt" class="btn ghost">‚¨áÔ∏è Export Excel</button>
          <button id="btnSyncManual" class="btn small primary" onclick="window.manualSyncAttendance()"
            style="display:flex; align-items:center; gap:5px; background-color:#0ea5e9; border-color:#0ea5e9; color:white; margin-left:8px;">
            ‚òÅÔ∏è Sync Cloud
          </button>
        </div>
      </div>

      <div class="card">
        <div class="table-wrap">
          <table class="table" id="tableAtt">
            <thead>
              <tr>
                <th style="padding-left:16px">WAKTU</th>
                <th>STATUS</th>
                <th>NID</th>
                <th>NAMA</th>
                <th>JABATAN</th>
                <th>PERUSAHAAN</th>
                <th>SHIFT</th>
                <th>KETERANGAN</th>
                <th style="text-align:right; padding-right:16px">AKSI</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- OVERTIME REPORT (Daytime Special) -->
    <section class="route hidden" id="route-overtime-report">
      <div class="toolbar" style="margin-bottom: 20px;">
        <div class="left" style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
          <label style="font-weight: 600;">Periode:
            <input type="date" id="otRepStart" class="input" style="width: auto;">
          </label>
          <span style="color: var(--muted);">-</span>
          <label>
            <input type="date" id="otRepEnd" class="input" style="width: auto;">
          </label>
          <!-- New Company Filter -->
          <select id="otRepCompany" class="input" style="width:auto;">
            <option value="">Semua Perusahaan</option>
          </select>
          <button id="btnGenOtReport" class="btn primary">üîç Tampilkan Laporan</button>
        </div>
        <div class="right">
          <button id="btnExportOtPdf" class="btn" style="background: #ef4444; color: white;">üìÑ Export PDF</button>
        </div>
      </div>

      <!-- Summary Cards -->
      <div class="grid-3" style="margin-bottom: 20px;">
        <div class="card stat">
          <div class="stat-sub">Total Karyawan Lembur</div>
          <div class="stat-val" id="otRepTotalEmp">0</div>
        </div>
        <div class="card stat">
          <div class="stat-sub">Total Jam Lembur</div>
          <div class="stat-val" id="otRepTotalHours">0</div>
        </div>
      </div>

      <!-- Table -->
      <div class="card">
        <div class="card-title">Rincian Lembur (Daytime Only)</div>
        <div class="table-wrap">
          <table class="table" id="tableOtReport">
            <thead>
              <tr>
                <th>TANGGAL</th>
                <th>NAMA</th>
                <th>SHIFT</th>
                <th>JAM PULANG</th>
                <th>DURASI</th>
                <th>KETERANGAN</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- LATEST -->
    <section class="route hidden" id="route-latest">
      <div class="toolbar">
        <div class="left"><button id="btnAddNews" class="btn primary">Ôºã Tambah Info</button></div>
      </div>
      <div class="card">
        <div class="table-wrap">
          <table class="table" id="tableNews">
            <thead>
              <tr>
                <th>WAKTU</th>
                <th>JUDUL</th>
                <th>DETAIL</th>
                <th style="text-align:right; padding-right:16px">AKSI</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- BARU: EDUCATION -->
    <section class="route hidden" id="route-education">
      <div class="toolbar">
        <div class="left">
          <button id="btnAddEdu" class="btn primary">Ôºã Tambah Education</button>
        </div>
      </div>
      <div class="card">
        <div class="table-wrap">
          <table class="table" id="tableEdu">
            <thead>
              <tr>
                <th>Waktu</th>
                <th>Judul</th>
                <th>Detail</th>
                <th>Gambar</th>
                <th style="width:140px">Aksi</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- BARU: INVENTORY -->
    <section class="route hidden" id="route-inventory">
      <div class="card">
        <div class="card-title">Keluar Masuk Barang</div>
        <div class="toolbar" style="flex-wrap: wrap; gap: 10px;">
          <div class="left" style="display:flex; gap:10px; align-items:center;">
            <button id="btnOpenInv" class="btn primary">Ôºã Buat Laporan</button>
            <div
              style="display:flex; align-items:center; gap:5px; margin-left:10px; padding-left:10px; border-left:1px solid #ddd;">
              <small>Periode:</small>
              <input type="date" id="invDateStart" class="input small">
              <span>-</span>
              <input type="date" id="invDateEnd" class="input small">
              <button id="btnExportInvPDF" class="btn small outline" title="Download PDF"
                style="display:flex; align-items:center; gap:5px">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path
                    d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z" />
                  <path
                    d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z" />
                </svg> PDF
              </button>
              <button id="btnSyncInv" class="btn small outline" title="Paksa Sync ke Cloud"
                onclick="window.forceSyncInventory()"
                style="display:flex; align-items:center; gap:5px; color:#059669; border-color:#059669;">
                üîÑ Sync
              </button>
              <button id="btnBackupInv" class="btn small outline" onclick="window.backupInventoryCSV()"
                title="Download data untuk upload manual"
                style="display:flex; align-items:center; gap:5px; color:#d97706; border-color:#d97706;">
                üíæ Backup CSV
              </button>
            </div>
          </div>
          <div class="right">
            <input type="text" id="invSearch" class="search" placeholder="Cari barang...">
          </div>
        </div>
        <div class="table-wrap">
          <table class="table">
            <thead>
              <tr>
                <th>No</th>
                <th>Tanggal</th>
                <th>Jam Masuk</th>
                <th>Jam Keluar</th>
                <th>Nama Pembawa</th>
                <th>Perusahaan / Ekspedisi</th>
                <th>Jenis Barang & Jumlah</th>
                <th>Tujuan / Penerima</th>
                <th>Petugas Sekuriti</th>
                <th>Aksi</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="10" class="muted" style="text-align:center; padding: 20px;">Belum ada data log barang.</td>
              </tr>
            </tbody>
          </table>
          </table>
        </div>
      </div>
    </section>

    <!-- ANALYSIS (BREAK) -->
    <section class="route hidden" id="route-analysis">
      <div class="header-modern" style="margin-bottom:20px;">
        <div class="header-content">
          <h1 class="header-title">Analisis Izin & Istirahat</h1>
          <div class="header-subtitle"><span data-i18n="analysis_subtitle">Laporan frekuensi izin keluar karyawan
              berdasarkan periode.</span></div>
        </div>
      </div>

      <div class="card toolbar" style="margin-bottom: 20px;">
        <div style="display:flex; flex-wrap:wrap; gap:12px; align-items:flex-end;">
          <label class="compact">
            <span class="label">Bulan</span>
            <input type="month" id="filterAnalysisMonth" class="input-sm">
          </label>
          <label class="compact">
            <span class="label">Perusahaan</span>
            <select id="filterAnalysisCompany" class="input-sm">
              <option value="">Semua Perusahaan</option>
            </select>
          </label>
          <button onclick="renderBreakAnalysis()" class="btn primary" style="height:38px;">üîç Tampilkan</button>
          <button onclick="exportBreakAnalysisPDF()" class="btn" style="height:38px; border:1px solid #ccc;">üìÑ Download
            PDF</button>
        </div>
      </div>

      <div class="card">
        <div class="table-wrap">
          <table class="table" id="tableAnalysis">
            <thead>
              <tr>
                <th style="width:50px;">Rank</th>
                <th>NID</th>
                <th>Nama Karyawan</th>
                <th>Perusahaan</th>
                <th style="text-align:center;">Total Izin Keluar</th>
                <th>Keterangan</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="6" class="muted" style="text-align:center;">Silakan pilih bulan dan klik Tampilkan.</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <!-- MODAL: EMPLOYEES -->
  <dialog id="empModal">
    <form method="dialog" class="modal">
      <button type="button" class="modal-close" id="btnCloseEmp" aria-label="Tutup">√ó</button>
      <h3 id="empModalTitle" data-i18n="modal_title_add_emp">Tambah Karyawan</h3>
      <div class="grid-2">
        <label><span data-i18n="modal_label_nid">NID</span> <input id="fNid" required></label>
        <label><span data-i18n="modal_label_name">Nama</span> <input id="fName" required></label>
        <label><span data-i18n="modal_label_job">Jabatan</span> <input id="fTitle" required></label>

        <label><span data-i18n="modal_label_company">Perusahaan</span>
          <select id="fCompanySel" required>
            <option value="">Pilih‚Ä¶</option>
            <option>PT PLN</option>
            <option>PT PLN NP</option>
            <option>PT PLN NPS</option>
            <option>PT MKP</option>
            <option>PT MKP IC</option>
            <option>PENGAMANAN/SECURITY</option>
            <option>VISITOR</option>
            <option>PIHAK KE 3</option>
            <option value="OTHER">OTHER</option>
          </select>
        </label>
        <label id="wrapCompanyOther" class="hidden"><span data-i18n="modal_label_other">Nama Perusahaan (Other)</span>
          <input id="fCompanyOther" placeholder="Tulis nama perusahaan‚Ä¶">
        </label>

        <label><span data-i18n="modal_label_shift">Shift</span>
          <select id="fShift">
            <option value="A">Group A</option>
            <option value="B">Group B</option>
            <option value="C">Group C</option>
            <option value="D">Group D</option>
            <option value="DAYTIME">Daytime</option>
          </select>
        </label>

        <label><span data-i18n="modal_label_photo_url">Foto (URL)</span> <input id="fPhoto"
            placeholder="https://‚Ä¶ atau biarkan kosong"></label>
        <label><span data-i18n="modal_label_photo_upload">Foto (Upload)</span> <input type="file" id="fPhotoFile"
            accept="image/*"></label>

        <div class="camera-actions" style="grid-column:1 / -1; justify-content:flex-end">
          <button type="button" class="btn" id="btnCamFront"><span data-i18n="modal_btn_cam_front">üì∏ Kamera
              Depan</span></button>
          <button type="button" class="btn" id="btnCamBack"><span data-i18n="modal_btn_cam_back">üì∑ Kamera
              Belakang</span></button>
          <small class="muted" data-i18n="modal_cam_hint">Jika akses kamera ditolak/tidak tersedia, sistem akan
            menawarkan unggah file.</small>
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn ghost" id="btnExitEmp" value="cancel" type="button"><span
            data-i18n="modal_btn_back">Keluar</span></button>
        <button class="btn primary" id="btnSaveEmp" value="default" type="button"><span
            data-i18n="modal_btn_save">Simpan</span></button>
      </div>
    </form>
  </dialog>

  <!-- MODAL: INFO -->
  <dialog id="newsModal">
    <form method="dialog" class="modal">
      <h3 data-i18n="modal_title_info">Info Terbaru</h3>
      <div class="grid-2">
        <label><span data-i18n="modal_label_title">Judul</span> <input id="nTitle" required></label>
        <label><span data-i18n="modal_label_link">Link (opsional)</span> <input id="nLink"
            placeholder="https://‚Ä¶"></label>
        <label style="grid-column:1 / -1"><span data-i18n="modal_label_body">Isi</span>
          <textarea id="nBody" rows="4" style="width:100%"></textarea>
        </label>
      </div>
      <div class="modal-actions">
        <button class="btn ghost" id="btnBackNews" value="cancel"><span
            data-i18n="modal_btn_back">Kembali</span></button>
        <button class="btn primary" id="btnSaveNews" value="default"><span
            data-i18n="modal_btn_save">Simpan</span></button>
      </div>
    </form>
  </dialog>

  <!-- BARU: MODAL EDUCATION -->
  <dialog id="eduModal">
    <form method="dialog" class="modal">
      <button type="button" class="modal-close" id="btnCloseEdu" aria-label="Tutup">√ó</button>
      <h3 id="eduModalTitle" data-i18n="modal_title_edu">Education</h3>
      <div class="grid-2">
        <label><span data-i18n="modal_label_title">Judul</span> <input id="eTitle" required></label>
        <label><span data-i18n="modal_label_img">Upload Gambar (opsional)</span> <input type="file" id="eImage"
            accept="image/*"></label>
        <label style="grid-column:1 / -1"><span data-i18n="modal_label_body">Detail</span>
          <textarea id="eBody" rows="4" style="width:100%"
            placeholder="Ringkasan materi / poin pembelajaran"></textarea>
        </label>
      </div>
      <div class="img-preview hidden" id="eImgWrap">
        <img id="ePreview" alt="Preview">
        <button type="button" class="btn ghost" id="btnClearImg"><span data-i18n="modal_btn_remove_img">Hapus
            Gambar</span></button>
        <small class="muted">Gambar otomatis dikompresi untuk hemat penyimpanan.</small>
      </div>
      <div class="modal-actions">
        <button class="btn ghost" id="btnBackEdu" value="cancel">Kembali</button>
        <button class="btn primary" id="btnSaveEdu" value="default">Simpan</button>
      </div>
    </form>
  </dialog>

  <!-- (opsional) elemen tersembunyi -->
  <canvas id="hiddenBarcode" width="560" height="180" class="hidden"></canvas>

  <!-- ===== Statistik Kehadiran Realtime (donut + tabel) ===== -->
  <script>
    (() => {
      const EMP_KEYS = ['SA_EMPLOYEES', 'employees', 'EMPLOYEES', 'mkp_employees', 'pd_employees'];
      const ATT_KEYS = ['SA_ATTENDANCE', 'attendance', 'attend_logs', 'attendance_today', 'attend_today', 'absensi_today'];
      const getFirstLS = (keys) => { for (const k of keys) { try { const v = localStorage.getItem(k); if (v) return JSON.parse(v) } catch (e) { } } return null };
      const todayISO = () => { const d = new Date(); const m = String(d.getMonth() + 1).padStart(2, '0'); const dd = String(d.getDate()).padStart(2, '0'); return `${d.getFullYear()}-${m}-${dd}` };
      const normEmployees = (arr) => Array.isArray(arr) ? arr.map(x => ({ id: x.nid ?? x.id ?? x.NID ?? x.employee_id ?? x.employeeId ?? x.kode ?? '', name: x.name ?? x.nama ?? x.fullname ?? x.employee_name ?? '', company: x.company ?? x.perusahaan ?? x.org ?? x.dept ?? x.instansi ?? 'UNKNOWN' })) : [];
      const pickTs = (x) => { const ts = x.ts ?? x.time ?? x.tanggal ?? x.datetime ?? x.date ?? x.created_at; return ts ? new Date(ts) : new Date() };
      const normAttendance = (arr) => Array.isArray(arr) ? arr.map(x => { const nid = x.nid ?? x.employeeId ?? x.id ?? x.NID ?? x.kode ?? x.employee_nid ?? ''; const type = (x.type ?? x.mode ?? x.status ?? x.scanType ?? x.event ?? x.ket ?? '').toString(); const d = pickTs(x); const date = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`; const company = x.company ?? x.perusahaan ?? x.org ?? x.dept ?? ''; return { nid, type, company, date } }) : [];
      const findCompanyByNid = (emps, nid) => (emps.find(e => e.id == nid)?.company) || 'UNKNOWN';
      function collectPresence() { const rawEmps = window.employees || window.APP?.employees || getFirstLS(EMP_KEYS) || []; const rawAtts = window.attendance || window.APP?.attendance || getFirstLS(ATT_KEYS) || []; const employees = normEmployees(rawEmps); const atts = normAttendance(rawAtts).filter(a => a.date === todayISO()); const map = Object.create(null); for (const e of employees) { const c = e.company || 'UNKNOWN'; (map[c] ||= { company: c, total: 0, present: 0, seen: new Set() }).total++ } for (const a of atts) { if (/in|datang|masuk/i.test(a.type)) { const c = a.company || findCompanyByNid(employees, a.nid); (map[c] ||= { company: c, total: 0, present: 0, seen: new Set() }); if (!map[c].seen.has(a.nid)) { map[c].present++; map[c].seen.add(a.nid) } } } const rows = Object.values(map).map(o => ({ company: o.company, total: o.total, present: o.present, percent: o.total ? Math.round(o.present / o.total * 100) : 0 })).sort((a, b) => (b.present - a.present) || a.company.localeCompare(b.company)); return rows }
      let pie = null;
      function renderPresence() {
        const panel = document.getElementById('scan-stats'); if (!panel) return;
        const rows = collectPresence();
        const tbody = document.getElementById('presenceTBody');
        if (tbody) {
          tbody.innerHTML = rows.map(r => `<tr><td>${r.company}</td><td><b>${r.present}</b> / ${r.total}</td><td>${r.percent}%</td><td><div class="presence-bar"><i style="width:${r.percent}%"></i></div></td></tr>`).join('');
        }
        const t = document.getElementById('scan-stats-time'); if (t) t.textContent = new Date().toLocaleTimeString();
        const ctx = document.getElementById('presencePie');
        if (ctx && window.Chart) {
          const labels = rows.map(r => r.company);
          const values = rows.map(r => r.present);
          if (pie) pie.destroy();
          pie = new Chart(ctx, { type: 'pie', data: { labels, datasets: [{ data: values }] }, options: { responsive: true, animation: false, plugins: { legend: { position: 'bottom' } } } });
        }
      }
      document.addEventListener('DOMContentLoaded', () => {
        renderPresence();
        setInterval(renderPresence, 15000);
        window.addEventListener('scan:saved', renderPresence);
        window.addEventListener('attendance:changed', renderPresence);
        window.addEventListener('attendance:update', renderPresence);
        window.refreshScanStats = renderPresence;
      });
    })();
  </script>

  <!-- ===== Kalender Bulan Ini (month-view) ===== -->
  <script>
    (function () {
      const ATT_KEYS = ['SA_ATTENDANCE', 'attendance', 'attend_logs', 'attendance_today', 'attend_today', 'absensi_today'];
      const getFirstLS = (keys) => { for (const k of keys) { try { const v = localStorage.getItem(k); if (v) return JSON.parse(v) } catch (e) { } } return null };
      const pickTs = (x) => { const ts = x.ts ?? x.time ?? x.tanggal ?? x.datetime ?? x.date ?? x.created_at; return ts ? new Date(ts) : new Date() };
      let calDate = new Date();
      function renderMonthCalendar(date = calDate) {
        calDate = new Date(date); const host = document.getElementById('monthCalendar'); if (!host) return;
        const y = calDate.getFullYear(); const m = calDate.getMonth(); const first = new Date(y, m, 1);
        const daysInPrev = new Date(y, m, 0).getDate(); const daysInCur = new Date(y, m + 1, 0).getDate();
        const startIdx = (first.getDay() + 6) % 7;
        const rawAtt = window.attendance || window.APP?.attendance || getFirstLS(ATT_KEYS) || [];
        const attDays = new Set(rawAtt.filter(r => { const d = pickTs(r); const st = (r.type || r.status || r.mode || r.event || '').toString(); return d.getFullYear() === y && d.getMonth() === m && /in|datang|masuk/i.test(st) }).map(r => pickTs(r).getDate()));
        const title = first.toLocaleDateString('id-ID', { month: 'long', year: 'numeric' });
        const dow = ['Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab', 'Min'];
        let cells = ''; for (let i = startIdx; i > 0; i--) { const d = daysInPrev - i + 1; cells += `<div class="mc-day muted" aria-disabled="true">${d}</div>` }
        const today = new Date(); for (let d = 1; d <= daysInCur; d++) { const isToday = (y === today.getFullYear() && m === today.getMonth() && d === today.getDate()); const has = attDays.has(d); cells += `<div class="mc-day ${isToday ? 'today' : ''} ${has ? 'has-logs' : ''}" data-day="${d}" tabindex="0"><span>${d}</span></div>` }
        const pad = 42 - (startIdx + daysInCur); for (let i = 1; i <= pad; i++) { cells += `<div class="mc-day muted" aria-disabled="true">${i}</div>` }
        host.innerHTML = `<div class="mc-head"><div class="mc-title">${title}</div><div class="mc-nav"><button class="btn" id="mcPrev">‚Äπ</button><button class="btn ghost" id="mcToday">Hari ini</button><button class="btn" id="mcNext">‚Ä∫</button></div></div><div class="mc-dow">${dow.map(d => `<div class="mc-d">${d}</div>`).join('')}</div><div class="mc-grid">${cells}</div>`;
        host.querySelector('#mcPrev')?.addEventListener('click', () => renderMonthCalendar(new Date(y, m - 1, 1)));
        host.querySelector('#mcNext')?.addEventListener('click', () => renderMonthCalendar(new Date(y, m + 1, 1)));
        host.querySelector('#mcToday')?.addEventListener('click', () => renderMonthCalendar(new Date()));
      }
      function scheduleMidnightTick() { const now = new Date(); const next = new Date(now); next.setHours(24, 0, 0, 150); setTimeout(() => { renderMonthCalendar(new Date()); scheduleMidnightTick() }, next - now) }
      document.addEventListener('DOMContentLoaded', () => { renderMonthCalendar(); scheduleMidnightTick(); window.addEventListener('attendance:update', () => renderMonthCalendar(calDate)); window.addEventListener('attendance:changed', () => renderMonthCalendar(calDate)) });
    })();
  </script>

  <!-- Jam kecil untuk header statistik company -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const el = document.getElementById('companyLiveTime'); if (!el) return;
      const tick = () => el.textContent = new Date().toLocaleTimeString();
      tick(); setInterval(tick, 1000);
    });
  </script>

  <!-- DEDUPE judul statistik di Dashboard -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const root = document.getElementById('route-dashboard'); if (!root) return;
      const normalize = s => (s || '').replace(/\s+/g, ' ').trim().toLowerCase();
      const dedupe = () => { const nodes = [...root.querySelectorAll('h1,h2,h3,.card-title,.card-title-light,b,strong,span,div')]; let kept = false; nodes.forEach(el => { const txt = normalize(el.textContent); if (txt.startsWith('statistik kehadiran')) { if (!kept) { kept = true } else { if (el.parentElement && el.parentElement.children.length === 1 && normalize(el.parentElement.textContent).startsWith('statistik kehadiran')) { el.parentElement.remove() } else { el.remove() } } } }) };
      dedupe(); new MutationObserver(dedupe).observe(root, { childList: true, subtree: true });
    });
  </script>



  <!-- App utama -->
  <!-- App utama (Removed duplicate) -->

  <!-- ===== LOCK GUARD untuk logo panel (anti mengecil) ===== -->
  <script>
    /* Legacy brand logo lock removed to allow CSS resizing */
    (function () { })();
  </script>

  <!-- >>> BARU: sinkron jumlah ‚Äú(N terakhir hari ini)‚Äù di header tabel recent <<< -->
  <script>
    (function () {
      function getLocal(key, fallback = []) {
        try { return JSON.parse(localStorage.getItem(key) || JSON.stringify(fallback)); }
        catch { return fallback; }
      }
      function startOfTodayMs() {
        const d = new Date(); d.setHours(0, 0, 0, 0); return d.getTime();
      }
      function computeCount() {
        const att = (window.attendance && Array.isArray(window.attendance))
          ? window.attendance
          : getLocal('SA_ATTENDANCE', []);
        const sod = startOfTodayMs();
        const today = att.filter(a => Number(a.ts || 0) >= sod);
        return Math.min(3, today.length);
      }
      function setHeader() {
        const c = computeCount();
        const count = document.getElementById('recentCount');
        if (count) { count.textContent = `(${c} terakhir hari ini)`; }
      }
      document.addEventListener('DOMContentLoaded', setHeader);
      window.addEventListener('attendance:update', setHeader);
      window.addEventListener('attendance:changed', setHeader);
      setInterval(setHeader, 15000);
    })();
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="config.local.js"></script>
  <script src="js/report.js"></script>
  <script src="js/db.js"></script>
  <script src="app.js"></script>

  <!-- MODAL: INVENTORY -->
  <dialog id="invModal" class="modal">
    <div class="modal-head">
      <h3 id="invModalTitle">Catat Barang</h3>
    </div>
    <div class="modal-body">
      <div class="grid-2">
        <label>Status <select id="iType">
            <option value="IN">Masuk</option>
            <option value="OUT">Keluar</option>
          </select></label>
        <label>Waktu <input type="datetime-local" id="iTime"></label>
        <label>Nama Pembawa <input type="text" id="iCarrier" placeholder="Nama lengkap"></label>
        <label>Perusahaan / Ekspedisi <input type="text" id="iCompany" placeholder="PT... / JNE / Gojek"></label>
        <label style="grid-column:1 / -1">Jenis Barang & Jumlah <textarea id="iItem" rows="2"
            placeholder="Contoh: Laptop Dell (1 unit), Dokumen (1 bundle)"></textarea></label>
        <label>Tujuan / Penerima <input type="text" id="iDest" placeholder="Divisi IT / Gudang"></label>
        <label>Petugas Sekuriti <input type="text" id="iOfficer"></label>
      </div>
    </div>
    <div class="modal-actions">
      <button id="btnBackInv" class="btn ghost">Batal</button>
      <button id="btnSaveInv" class="btn primary">Simpan</button>
    </div>
  </dialog>
  <!-- OLD NAV (Corrupt) -->
  <div style="display:none">
    <nav class="mobile-bottom-nav">
      <div class="mb-item active" data-route="dashboard" onclick="window.appRoute('dashboard')">
        <div class="icon">üè†</div><span>Beranda</span>
      </div>
      <div class="mb-item" data-route="scan" onclick="window.appRoute('scan')">
        <div class="icon">üì∏</div><span>Absen</span>
      </div>
      <div class="mb-item" data-route="attendance" onclick="window.appRoute('attendance')">
        <div class="icon">üìÑ</div><span>Laporan</span>
      </div>
      <div class="mb-item" data-route="general-report" onclick="window.appRoute('general-report')">
        <div class="icon">ÔøΩ</div><span>Analisis</span>
      </div>
    </nav>
  </div> <!-- End Hide -->

  <!-- MOBILE BOTTOM NAV (5 Items) -->
  <nav class="mobile-bottom-nav">
    <div class="mb-item active" data-route="dashboard" onclick="window.appRoute('dashboard')">
      <div class="icon">üè†</div><span>Beranda</span>
    </div>
    <div class="mb-item" data-route="scan" onclick="window.appRoute('scan')">
      <div class="icon">üì∏</div><span>Absen</span>
    </div>
    <div class="mb-item" data-route="employees" onclick="window.appRoute('employees')">
      <div class="icon">üë•</div><span>Karyawan</span>
    </div>
    <div class="mb-item" data-route="inventory" onclick="window.appRoute('inventory')">
      <div class="icon">üì¶</div><span>Logistik</span>
    </div>
    <div class="mb-item" onclick="window.toggleMobileMenu()">
      <div class="icon">‚ò∞</div><span>Menu</span>
    </div>
  </nav>


  <!-- Service Worker Registration for PWA -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('serviceWorker.js')
          .then(reg => console.log('SW Registered!', reg.scope))
          .catch(err => console.log('SW Failed:', err));
      });
    }
  </script>
  <script src="app.js"></script>
  <script src="mobile-camera.js"></script>
</body>

</html>